
# coding: utf-8

# In[1]:


import pandas as pd
import numpy as np
import scipy.stats as stats
from scipy.stats import chi2

comic = pd.read_csv('/Users/Michela/Documents/Kaggle/marvel-wikia-data.csv')


# In[2]:


comic.head()


# In[3]:


comic = comic.drop('urlslug',1);
comic = comic.drop('page_id',1)


# In[4]:


comic.head()


# In[5]:


comic.describe()


# In[6]:


comic.hist('Year', bins=100);
comic.hist('APPEARANCES', bins=100)


# In[7]:


import matplotlib.pyplot as plt


# In[8]:


pd.value_counts(comic['EYE']).plot.bar()


# In[9]:


pd.value_counts(comic['HAIR']).plot.bar()


# In[10]:



pd.value_counts(comic['HAIR']).plot.bar()


# In[11]:


import seaborn as sns
g = sns.FacetGrid(comic, col="ALIGN")

w = g.map(plt.hist, "APPEARANCES")


# In[13]:


g = sns.FacetGrid(comic, col="ALIGN")
g = g.map(plt.hist, "Year")


# In[14]:


#seperate the data into good, bad, neutral

good = comic[comic['ALIGN'].str.contains("Good Characters", na=False)]
bad = comic[comic['ALIGN'].str.contains("Bad Characters", na=False)]
neutral = comic[comic['ALIGN'].str.contains("Neutral Characters", na=False)]


# In[50]:


import warnings
warnings.filterwarnings('ignore')

good_hair = plt.figure(1);
pd.value_counts(good['HAIR']).plot.bar(title="Good hair colour"); good_hair.show()
evil_hair = plt.figure(2);
pd.value_counts(bad['HAIR']).plot.bar(title="Evil hair colour"); evil_hair.show()
neutral_hair = plt.figure(3);
pd.value_counts(neutral['HAIR']).plot.bar(title="Neutral hair colour"); neutral_hair.show()


# In[51]:


good_eyes = plt.figure(1);
pd.value_counts(good['EYE']).plot.bar(title="Good eye colour"); good_eyes.show()
evil_eyes = plt.figure(2);
pd.value_counts(bad['EYE']).plot.bar(title="Evil eye colour"); evil_eyes.show()
neutral_eyes = plt.figure(3);
pd.value_counts(neutral['EYE']).plot.bar(title="Neutral eye colour"); neutral_eyes.show()


# In[52]:


good_gsm = plt.figure(1);
pd.value_counts(good['GSM']).plot.bar(title="Good gender/sexual minority"); good_gsm.show()
evil_gsm = plt.figure(2);
pd.value_counts(bad['GSM']).plot.bar(title="Evil gender/sexual minority"); evil_gsm.show()
neutral_gsm = plt.figure(3);
pd.value_counts(neutral['GSM']).plot.bar(title="Neutral gender/sexual minority"); neutral_gsm.show()



# In[53]:


good_id = plt.figure(1);
pd.value_counts(good['ID']).plot.bar(title="Good ID"); good_id.show()
evil_id = plt.figure(2);
pd.value_counts(bad['ID']).plot.bar(title="Evil ID"); evil_id.show()
neutral_id = plt.figure(3);
pd.value_counts(neutral['ID']).plot.bar(title="Neutral ID"); neutral_id.show()


# In[ ]:


#question - based on physical characteristics, can we tell the fate of a superhero?
#Will they be evil or good? Will they have a secret ID? Can appearance determine if they will live or die?

#Start with basic classification techniques

#what are our X variables - hair, eye, GSM, Year, Identity
#what are our Y variables - ALIGN to start




# In[15]:


#get dummy variables

hair = pd.get_dummies(comic['HAIR'])
eyes = pd.get_dummies(comic['EYE'])
id_type = pd.get_dummies(comic['ID'])
align = pd.get_dummies(comic['ALIGN'])
sex = pd.get_dummies(comic['SEX'])

comic_clean = comic
comic_clean = comic_clean.join([eyes, hair, id_type, align, sex])
comic_clean = comic_clean.drop(['ALIGN', 'HAIR', 'EYE', 'ID', 'name', 'SEX'], axis=1)


# In[21]:



comic_clean.shape;
list(comic_clean);


# In[22]:


comic_clean.head()


# In[32]:


#initialize the predictors
predictors = comic_clean.iloc[:,6:65]
y=comic_clean['APPEARANCES']


# In[38]:


y.mean()


# In[48]:


np.where(np.isnan(y))


# In[47]:


y = y.fillna(y.mean())


# In[92]:


from sklearn.feature_selection import RFE
from sklearn.linear_model import LogisticRegression
import statsmodels.api as sm
from sklearn import linear_model

lm = linear_model.LinearRegression()


# In[122]:


reg = lm.fit(predictors, y)


# In[78]:


pd.DataFrame(list(zip(predictors.columns, lm.coef_)), columns=['Features', 'Estimated Coefficients'])

#can now predict the number of appearances based on appearance

#how to wrap this?  


# In[116]:


from sklearn.linear_model import Lasso

lasso_model = Lasso()





# In[124]:


model = make_pipeline(lm)
model2 = make_pipeline(Lasso(alpha=0.1))


# In[125]:


model2.results =lasso_model.fit(predictors, y)


# In[128]:


pd.DataFrame(list(zip(predictors.columns, lm.coef_, lasso_model.coef_)), columns=['Features', 'Estimated Coefficients', 'Lasso coefficients'])

#can now predict the number of appearances based on appearance

#which has the better predictive power?

#would need to split data into training and testing datasets
#then 


# In[130]:


from sklearn.model_selection import train_test_split
X_train, X_test, y_train, y_test = train_test_split(predictors, y, test_size=0.2)

